

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Settings (ops.npy) &mdash; suite2p 0.6.17 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Using the GUI" href="gui.html" />
    <link rel="prev" title="Inputs" href="inputs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> suite2p
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Basics:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="inputs.html">Inputs</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Settings (ops.npy)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#main-settings">Main settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#output-settings">Output settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#registration">Registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#roi-detection">ROI detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#signal-extraction">Signal extraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#spike-deconvolution">Spike deconvolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#channel-2-settings">Channel 2 settings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gui.html">Using the GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="outputs.html">Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiday.html">Multiday recordings</a></li>
</ul>
<p class="caption"><span class="caption-text">How it works:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="registration.html">Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="celldetection.html">Cell detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="roiextraction.html">Signal extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="deconvolution.html">Spike deconvolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="autoapi/index.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">suite2p</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Settings (ops.npy)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/settings.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="settings-ops-npy">
<h1>Settings (ops.npy)<a class="headerlink" href="#settings-ops-npy" title="Permalink to this headline">¶</a></h1>
<p>Here is a summary of all the parameters that the pipeline takes, and its
default value.</p>
<div class="section" id="main-settings">
<h2>Main settings<a class="headerlink" href="#main-settings" title="Permalink to this headline">¶</a></h2>
<p>These are the essential settings that are dataset-specific.</p>
<ul class="simple">
<li><p><strong>nplanes</strong>: (<em>int, default: 1</em>) each tiff has this many planes in
sequence</p></li>
<li><p><strong>nchannels</strong>: (<em>int, default: 1</em>) each tiff has this many channels
per plane</p></li>
<li><p><strong>functional_chan</strong>: (<em>int, default: 1</em>) this channel is used to
extract functional ROIs (1-based, so 1 means first channel, and 2
means second channel)</p></li>
<li><p><strong>tau</strong>: (<em>float, default: 1.0</em>) The timescale of the sensor (in
seconds), used for deconvolution kernel. The kernel is fixed to have
this decay and is not fit to the data. We recommend:</p>
<ul>
<li><p>0.7 for GCaMP6f</p></li>
<li><p>1.0 for GCaMP6m</p></li>
<li><p>1.25-1.5 for GCaMP6s</p></li>
</ul>
</li>
<li><p><strong>fs</strong>: (<em>float, default: 10.0</em>) Sampling rate (per plane). For
instance, if you have a 10 plane recording acquired at 30Hz, then the
sampling rate per plane is 3Hz, so set ops[‘fs’] = 3.</p></li>
<li><p><strong>do_bidiphase</strong>: (<em>bool, default: False</em>) whether or not to compute
bidirectional phase offset from misaligned line scanning experiment
(applies to 2P recordings only). suite2p will estimate the
bidirectional phase offset from ops[‘nimg_init’] frames if this is
set to 1 (and ops[‘bidiphase’]=0), and then apply this computed
offset to all frames.</p></li>
<li><p><strong>bidiphase</strong>: (<em>int, default: 0</em>) bidirectional phase offset from
line scanning (set by user). If set to any value besides 0, then this
offset is used and applied to all frames in the recording.</p></li>
</ul>
</div>
<div class="section" id="output-settings">
<h2>Output settings<a class="headerlink" href="#output-settings" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>preclassify</strong>: (<em>float, default: 0.3</em>) (<strong>new</strong>) apply classifier
before signal extraction with probability threshold of “preclassify”.
If this is set to 0.0, then all detected ROIs are kept and signals
are computed.</p></li>
<li><p><strong>save_mat</strong>: (<em>bool, default: False</em>) whether to save the results in
matlab format in file “Fall.mat”. NOTE the cells you click in the GUI
will NOT change “Fall.mat”. But there is a <strong>new</strong> button in the GUI
you can click to resave “Fall.mat” in the “File” window.</p></li>
<li><p><strong>combined</strong>: (<em>bool, default: True</em>) combine results across planes
in separate folder “combined” at end of processing. This folder will
allow all planes to be loaded into the GUI simultaneously.</p></li>
<li><p><strong>aspect</strong>: (<em>float, default: 1.0) (**new*</em>) ratio of um/pixels in X
to um/pixels in Y (ONLY for correct aspect ratio in GUI, not used for
other processing)</p></li>
</ul>
</div>
<div class="section" id="registration">
<h2>Registration<a class="headerlink" href="#registration" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>do_registration</strong>: (<em>bool, default: True</em>) whether or not to run
registration</p></li>
<li><p><strong>align_by_chan</strong>: (<em>int, default: 1</em>) which channel to use for
alignment (1-based, so 1 means 1st channel and 2 means 2nd channel).
If you have a non-functional channel with something like td-Tomato
expression, you may want to use this channel for alignment rather
than the functional channel.</p></li>
<li><p><strong>nimg_init</strong>: (<em>int, default: 200</em>) how many frames to use to</p></li>
</ul>
<blockquote>
<div><p>compute reference image for registration</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>batch_size</strong>: (<em>int, default: 200</em>) how many frames to register</p></li>
</ul>
<blockquote>
<div><p>simultaneously in each batch. This depends on memory constraints - it
will be faster to run if the batch is larger, but it will require
more RAM.</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>maxregshift</strong>: (<em>float, default: 0.1</em>) the maximum shift as a</p></li>
</ul>
<blockquote>
<div><p>fraction of the frame size. If the frame is Ly pixels x Lx pixels,
then the maximum pixel shift in pixels will be max(Ly,Lx) *
ops[‘maxregshift’].</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>smooth_sigma</strong>: (<em>float, default: 1.15</em>) standard deviation in</p></li>
</ul>
<blockquote>
<div><p>pixels of the gaussian used to smooth the phase correlation between
the reference image and the frame which is being registered. A value
of <em>&gt;4</em> is recommended for one-photon recordings (with a 512x512
pixel FOV).</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>smooth_sigma_time</strong>: (<em>float, default: 0</em>) standard deviation in time frames
of the gaussian used to smooth the data before phase correlation is computed.
Might need this to be set to 1 or 2 for low SNR data.</p></li>
<li><p><strong>keep_movie_raw</strong>: (<em>bool, default: True</em>) whether or not to keep</p></li>
</ul>
<blockquote>
<div><p>the binary file of the non-registered frames. You can view the
registered and non-registered binaries together in the GUI in the
“View registered binaries” view if you set this to <em>True</em>.</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>two_step_registration</strong>: (<em>bool, default: False</em>) whether or not to run
registration twice (for low SNR data). <em>keep_movie_raw</em> must be True for this
to work.</p></li>
<li><p><strong>reg_tif</strong>: (<em>bool, default: False</em>) whether or not to write the</p></li>
</ul>
<blockquote>
<div><p>registered binary to tiff files</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>reg_tif_chan2</strong>: (<em>bool, default: False</em>) whether or not to write</p></li>
</ul>
<blockquote>
<div><p>the registered binary of the non-functional channel to tiff files</p>
</div></blockquote>
<p><strong>1P registration settings</strong></p>
<ul class="simple">
<li><p><strong>1Preg</strong>: (<em>bool, default: False</em>) whether to perform high-pass</p></li>
</ul>
<blockquote>
<div><p>spatial filtering and tapering (parameters set below), which help
with 1P registration</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>spatial_hp</strong>: (<em>int, default: 50</em>) window in pixels for spatial</p></li>
</ul>
<blockquote>
<div><p>high-pass filtering before registration</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>pre_smooth</strong>: (<em>float, default: 2</em>) if &gt; 0, defines stddev of</p></li>
</ul>
<blockquote>
<div><p>Gaussian smoothing, which is applied before spatial high-pass
filtering</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>spatial_taper</strong>: (<em>float, default: 50</em>) how many pixels to ignore</p></li>
</ul>
<blockquote>
<div><p>on edges - they are set to zero (important for vignetted windows, for
FFT padding do not set BELOW 3*ops[‘smooth_sigma’])</p>
</div></blockquote>
<p><strong>Non-rigid registration</strong></p>
<ul class="simple">
<li><p><strong>nonrigid</strong>: (<em>bool, default: True</em>) whether or not to perform</p></li>
</ul>
<blockquote>
<div><p>non-rigid registration, which splits the field of view into blocks
and computes registration offsets in each block separately.</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>block_size</strong>: (<em>two ints, default: [128,128]</em>) size of blocks for</p></li>
</ul>
<blockquote>
<div><p>non-rigid registration, in pixels. HIGHLY recommend keeping this a
power of 2 and/or 3 (e.g. 128, 256, 384, etc) for efficient fft</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>snr_thresh</strong>: (<em>float, default: 1.2</em>) how big the phase correlation</p></li>
</ul>
<blockquote>
<div><p>peak has to be relative to the noise in the phase correlation map for
the block shift to be accepted. In low SNR recordings like
one-photon, I’d recommend a larger value like <em>1.5</em>, so that block
shifts are only accepted if there is significant SNR in the phase
correlation.</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>maxregshiftNR</strong>: (<em>float, default: 5.0</em>) maximum shift in pixels of</p></li>
</ul>
<blockquote>
<div><p>a block relative to the rigid shift</p>
</div></blockquote>
</div>
<div class="section" id="roi-detection">
<h2>ROI detection<a class="headerlink" href="#roi-detection" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>roidetect</strong>: (<em>bool, default: True</em>) whether or not to run ROI</p></li>
</ul>
<blockquote>
<div><p>detect and extraction</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>sparse_mode</strong>: (<em>bool, default: False</em>) whether or not to use sparse_mode cell detection</p></li>
<li><p><strong>spatial_scale</strong>: (<em>int, default: 0</em>), what the optimal scale of the</p></li>
</ul>
<blockquote>
<div><p>recording is in pixels. if set to 0, then the algorithm determines it
automatically (recommend this on the first try). If it seems off, set it yourself to the following values:
1 (=6 pixels), 2 (=12 pixels), 3 (=24 pixels), or 4 (=48 pixels).</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>connected</strong>: (<em>bool, default: True</em>) whether or not to require ROIs
to be fully connected (set to <em>0</em> for dendrites/boutons)</p></li>
<li><p><strong>threshold_scaling</strong>: (<em>float, default: 5.0</em>) this controls the
threshold at which to detect ROIs (how much the ROIs have to stand
out from the noise to be detected). if you set this higher, then
fewer ROIs will be detected, and if you set it lower, more ROIs will
be detected.</p></li>
<li><p><strong>max_overlap</strong>: (<em>float, default: 0.75</em>) we allow overlapping ROIs
during cell detection. After detection, ROIs with more than
ops[‘max_overlap’] fraction of their pixels overlapping with other
ROIs will be discarded. Therefore, to throw out NO ROIs, set this to
1.0.</p></li>
<li><p><strong>high_pass</strong>: (<em>int, default: 100</em>) running mean subtraction across
time with window of size ‘high_pass’. Values of less than 10 are
recommended for 1P data where there are often large full-field
changes in brightness.</p></li>
<li><p><strong>smooth_masks</strong>: (<em>bool, default: True</em>) whether to smooth masks in
final pass of cell detection. This is useful especially if you are in
a high noise regime.</p></li>
<li><p><strong>max_iterations</strong>: (<em>int, default: 20</em>) how many iterations over
which to extract cells - at most ops[‘max_iterations’], but usually
stops before due to ops[‘threshold_scaling’] criterion.</p></li>
<li><p><strong>nbinned</strong>: (<em>int, default: 5000</em>) maximum number of binned frames
to use for ROI detection.</p></li>
</ul>
</div>
<div class="section" id="signal-extraction">
<h2>Signal extraction<a class="headerlink" href="#signal-extraction" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>allow_overlap</strong>: (<em>bool, default: False</em>) whether or not to extract
signals from pixels which belong to two ROIs. By default, any pixels
which belong to two ROIs (overlapping pixels) are excluded from the
computation of the ROI trace.</p></li>
<li><p><strong>min_neuropil_pixels</strong>: (<em>int, default: 350</em>) minimum number of
pixels used to compute neuropil for each cell</p></li>
<li><p><strong>inner_neuropil_radius</strong>: (<em>int, default: 2</em>) number of pixels to
keep between ROI and neuropil donut</p></li>
</ul>
</div>
<div class="section" id="spike-deconvolution">
<h2>Spike deconvolution<a class="headerlink" href="#spike-deconvolution" title="Permalink to this headline">¶</a></h2>
<p>We neuropil-correct the trace Fout = F - ops[‘neucoeff’] * Fneu, and
then baseline-correct these traces with an ops[‘baseline’] filter, and
then detect spikes.</p>
<ul class="simple">
<li><p><strong>neucoeff</strong>: (<em>float, default: 0.7</em>) neuropil coefficient for all
ROIs.</p></li>
<li><p><strong>baseline</strong>: (<em>string, default ‘maximin’</em>) how to compute the
baseline of each trace. This baseline is then subtracted from each
cell. <em>‘maximin’</em> computes a moving baseline by filtering the data
with a Gaussian of width ops[‘sig_baseline’] * ops[‘fs’], and then
minimum filtering with a window of ops[‘win_baseline’] * ops[‘fs’],
and then maximum filtering with the same window. <em>‘constant’</em>
computes a constant baseline by filtering with a Gaussian of width
ops[‘sig_baseline’] * ops[‘fs’] and then taking the minimum value of
this filtered trace. <em>‘constant_percentile’</em> computes a constant
baseline by taking the ops[‘prctile_baseline’] percentile of the
trace.</p></li>
<li><p><strong>win_baseline</strong>: (<em>float, default: 60.0</em>) window for maximin filter
in seconds</p></li>
<li><p><strong>sig_baseline</strong>: (<em>float, default: 10.0</em>) Gaussian filter width in</p></li>
</ul>
<blockquote>
<div><p>seconds, used before maximin filtering or taking the minimum value of
the trace, ops[‘baseline’] = ‘maximin’ or ‘constant’.</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>prctile_baseline</strong>: (<em>float, optional, default: 8</em>) percentile of</p></li>
</ul>
<blockquote>
<div><p>trace to use as baseline if ops[‘baseline’] = ‘constant_percentile’.</p>
</div></blockquote>
</div>
<div class="section" id="channel-2-settings">
<h2>Channel 2 settings<a class="headerlink" href="#channel-2-settings" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>chan2_thres</strong>: threshold for calling an ROI “detected” on a second</p></li>
</ul>
<blockquote>
<div><p>channel</p>
</div></blockquote>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="gui.html" class="btn btn-neutral float-right" title="Using the GUI" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="inputs.html" class="btn btn-neutral float-left" title="Inputs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Carsen Stringer, Marius Pachitariu

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>