

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>suite2p.gui2p &mdash; suite2p 0.6.17 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> suite2p
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">API Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">suite2p API Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">suite2p</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>suite2p.gui2p</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for suite2p.gui2p</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="k">import</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtCore</span>
<span class="kn">import</span> <span class="nn">pyqtgraph</span> <span class="k">as</span> <span class="nn">pg</span>
<span class="kn">from</span> <span class="nn">pyqtgraph</span> <span class="k">import</span> <span class="n">GraphicsScene</span>
<span class="kn">from</span> <span class="nn">suite2p</span> <span class="k">import</span> <span class="n">fig</span><span class="p">,</span> <span class="n">gui</span><span class="p">,</span> <span class="n">classifier</span><span class="p">,</span> <span class="n">visualize</span><span class="p">,</span> <span class="n">reggui</span><span class="p">,</span> <span class="n">classgui</span><span class="p">,</span> <span class="n">merge</span><span class="p">,</span> <span class="n">drawroi</span>
<span class="kn">from</span> <span class="nn">pkg_resources</span> <span class="k">import</span> <span class="n">iter_entry_points</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="k">import</span> <span class="n">gaussian_filter1d</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">io</span>

<span class="k">def</span> <span class="nf">resample_frames</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xt</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; resample y (defined at x) at times xt &#39;&#39;&#39;</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">xt</span><span class="o">.</span><span class="n">size</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ts</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">)</span>
    <span class="n">yt</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">xt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">yt</span>

<div class="viewcode-block" id="MainW"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW">[docs]</a><span class="k">class</span> <span class="nc">MainW</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QMainWindow</span><span class="p">):</span>
<div class="viewcode-block" id="MainW.__init__"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MainW</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="n">pg</span><span class="o">.</span><span class="n">setConfigOptions</span><span class="p">(</span><span class="n">imageAxisOrder</span><span class="o">=</span><span class="s2">&quot;row-major&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;suite2p (run pipeline or load stat.npy)&quot;</span><span class="p">)</span>
        <span class="n">icon_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s2">&quot;logo/logo.png&quot;</span>
        <span class="p">)</span>
        <span class="n">app_icon</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">()</span>
        <span class="n">app_icon</span><span class="o">.</span><span class="n">addFile</span><span class="p">(</span><span class="n">icon_path</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
        <span class="n">app_icon</span><span class="o">.</span><span class="n">addFile</span><span class="p">(</span><span class="n">icon_path</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
        <span class="n">app_icon</span><span class="o">.</span><span class="n">addFile</span><span class="p">(</span><span class="n">icon_path</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
        <span class="n">app_icon</span><span class="o">.</span><span class="n">addFile</span><span class="p">(</span><span class="n">icon_path</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mi">48</span><span class="p">))</span>
        <span class="n">app_icon</span><span class="o">.</span><span class="n">addFile</span><span class="p">(</span><span class="n">icon_path</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="mi">96</span><span class="p">))</span>
        <span class="n">app_icon</span><span class="o">.</span><span class="n">addFile</span><span class="p">(</span><span class="n">icon_path</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowIcon</span><span class="p">(</span><span class="n">app_icon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QMainWindow {background: &#39;black&#39;;}&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stylePressed</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;QPushButton {Text-align: left; &quot;</span>
                             <span class="s2">&quot;background-color: rgb(100,50,100); &quot;</span>
                             <span class="s2">&quot;color:white;}&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">styleUnpressed</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;QPushButton {Text-align: left; &quot;</span>
                               <span class="s2">&quot;background-color: rgb(50,50,50); &quot;</span>
                               <span class="s2">&quot;color:white;}&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">styleInactive</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;QPushButton {Text-align: left; &quot;</span>
                              <span class="s2">&quot;background-color: rgb(50,50,50); &quot;</span>
                              <span class="s2">&quot;color:gray;}&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">### first time running, need to check for user files</span>
        <span class="c1"># check for classifier file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
            <span class="s2">&quot;classifiers/classifier_user.npy&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classorig</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
            <span class="s2">&quot;classifiers/classifier.npy&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classfile</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classorig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">classfile</span><span class="p">)</span>
        <span class="c1"># check for ops file (for running suite2p)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opsorig</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                                          <span class="s1">&#39;ops/ops.npy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opsfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                                          <span class="s1">&#39;ops/ops_user.npy&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opsfile</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opsorig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opsfile</span><span class="p">)</span>


        <span class="c1"># default plot options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># --------------- MENU BAR --------------------------</span>
        <span class="c1"># run suite2p from scratch</span>
        <span class="n">runS2P</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;&amp;Run suite2p &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">runS2P</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="s2">&quot;Ctrl+R&quot;</span><span class="p">)</span>
        <span class="n">runS2P</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_suite2p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">runS2P</span><span class="p">)</span>

        <span class="c1"># load processed data</span>
        <span class="n">loadProc</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;&amp;Load processed data&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">loadProc</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="s2">&quot;Ctrl+L&quot;</span><span class="p">)</span>
        <span class="n">loadProc</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_dialog</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">loadProc</span><span class="p">)</span>

        <span class="c1"># load a behavioral trace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadBeh</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span>
            <span class="s2">&quot;Load behavior or stim trace (1D only)&quot;</span><span class="p">,</span> <span class="bp">self</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadBeh</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_behavior</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadBeh</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadBeh</span><span class="p">)</span>

        <span class="c1"># load processed data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveMat</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;&amp;Save to mat file (*.mat)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveMat</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="s2">&quot;Ctrl+S&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveMat</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_mat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveMat</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveMat</span><span class="p">)</span>

        <span class="c1"># export figure</span>
        <span class="n">exportFig</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Export as image (svg)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">exportFig</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_fig</span><span class="p">)</span>
        <span class="n">exportFig</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">exportFig</span><span class="p">)</span>

        <span class="c1"># export figure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manual</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Manual labelling&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manual</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manual_label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manual</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># make mainmenu!</span>
        <span class="n">main_menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menuBar</span><span class="p">()</span>
        <span class="n">file_menu</span> <span class="o">=</span> <span class="n">main_menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;&amp;File&quot;</span><span class="p">)</span>
        <span class="n">file_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">runS2P</span><span class="p">)</span>
        <span class="n">file_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">loadProc</span><span class="p">)</span>
        <span class="n">file_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadBeh</span><span class="p">)</span>
        <span class="n">file_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveMat</span><span class="p">)</span>
        <span class="n">file_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">exportFig</span><span class="p">)</span>
        <span class="n">file_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manual</span><span class="p">)</span>
        <span class="c1"># classifier menu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trainfiles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statlabels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadMenu</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMenu</span><span class="p">(</span><span class="s2">&quot;Load&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadClass</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;from file&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadClass</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_classifier</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadClass</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadClass</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadUClass</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;default classifier&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadUClass</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_default_classifier</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadUClass</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadUClass</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadSClass</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;built-in classifier&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadSClass</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_s2p_classifier</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadSClass</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadSClass</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadTrain</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Build&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadTrain</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">classgui</span><span class="o">.</span><span class="n">load_list</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadTrain</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveDefault</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Save loaded as default&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveDefault</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">class_default</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveDefault</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resetDefault</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Reset default to built-in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resetDefault</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_default</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resetDefault</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">class_menu</span> <span class="o">=</span> <span class="n">main_menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;&amp;Classifier&quot;</span><span class="p">)</span>
        <span class="n">class_menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadMenu</span><span class="p">)</span>
        <span class="n">class_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadTrain</span><span class="p">)</span>
        <span class="n">class_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resetDefault</span><span class="p">)</span>
        <span class="n">class_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveDefault</span><span class="p">)</span>

        <span class="c1"># visualizations menuBar</span>
        <span class="n">vis_menu</span> <span class="o">=</span> <span class="n">main_menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;&amp;Visualizations&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visualizations</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;&amp;Visualize selected cells&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visualizations</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis_window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visualizations</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">vis_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visualizations</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visualizations</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="s2">&quot;Ctrl+V&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custommask</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Load custom hue for ROIs (*.npy)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custommask</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_custom_mask</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custommask</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">vis_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custommask</span><span class="p">)</span>

        <span class="c1"># registration menuBar</span>
        <span class="n">reg_menu</span> <span class="o">=</span> <span class="n">main_menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;&amp;Registration&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reg</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;View registered &amp;binary&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reg</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reg_window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reg</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="s2">&quot;Ctrl+B&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reg</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regPC</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;View registration &amp;Metrics&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regPC</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regPC_window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regPC</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="s2">&quot;Ctrl+M&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regPC</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">reg_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reg</span><span class="p">)</span>
        <span class="n">reg_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regPC</span><span class="p">)</span>

        <span class="c1"># plugin menu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">plugin_menu</span> <span class="o">=</span> <span class="n">main_menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s1">&#39;&amp;Plugins&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entry_pt</span> <span class="ow">in</span> <span class="n">iter_entry_points</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;suite2p.plugin&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">[</span><span class="n">entry_pt</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="n">entry_pt</span><span class="o">.</span><span class="n">menu</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">[</span><span class="n">entry_pt</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">entry_pt</span><span class="o">.</span><span class="n">window</span><span class="p">)</span>
            <span class="n">plugin_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">[</span><span class="n">entry_pt</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>

        <span class="c1"># --------- MAIN WIDGET LAYOUT ---------------------</span>
        <span class="n">cwidget</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>
        <span class="n">cwidget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="n">cwidget</span><span class="p">)</span>
        <span class="c1"># ROI CHECKBOX</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">setVerticalSpacing</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkBox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;ROIs On [space bar]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkBox</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: white;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkBox</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROIs_on</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkBox</span><span class="o">.</span><span class="n">toggle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkBox</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># number of ROIs in each image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lcell0</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lcell0</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: white;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lcell0</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignVCenter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lcell0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lcell1</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lcell1</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: white;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lcell1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># buttons to draw a square on view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topbtns</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QButtonGroup</span><span class="p">()</span>
        <span class="n">ql</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;select cells&quot;</span><span class="p">)</span>
        <span class="n">ql</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: white;&quot;</span><span class="p">)</span>
        <span class="n">ql</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ql</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">btn</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">TopButton</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topbtns</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">b</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topbtns</span><span class="o">.</span><span class="n">setExclusive</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isROI</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROIplot</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ql</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;n=&quot;</span><span class="p">)</span>
        <span class="n">ql</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignVCenter</span><span class="p">)</span>
        <span class="n">ql</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: white;&quot;</span><span class="p">)</span>
        <span class="n">ql</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ql</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># self.l0.setColumnStretch(5,0.1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topedit</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topedit</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QIntValidator</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topedit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;40&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ntop</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topedit</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topedit</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topedit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top_number_chosen</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topedit</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># minimize view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizebtns</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QButtonGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; cells&quot;</span><span class="p">,</span> <span class="s2">&quot; both&quot;</span><span class="p">,</span> <span class="s2">&quot; not cells&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
            <span class="n">btn</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">SizeButton</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sizebtns</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">14</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizebtns</span><span class="o">.</span><span class="n">setExclusive</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1">##### -------- MAIN PLOTTING AREA ---------- ####################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">GraphicsLayoutWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">ci</span><span class="o">.</span><span class="n">layout</span>
        <span class="c1"># --- cells image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">addViewBox</span><span class="p">(</span>
            <span class="n">lockAspect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;plot1&quot;</span><span class="p">,</span>
            <span class="n">border</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
            <span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">invertY</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img1</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">ImageItem</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">setMenuEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">contextMenuItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">700</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img1</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img1</span><span class="p">)</span>
        <span class="c1"># --- noncells image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">addViewBox</span><span class="p">(</span>
            <span class="n">lockAspect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;plot2&quot;</span><span class="p">,</span>
            <span class="n">border</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
            <span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">invertY</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">setMenuEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">contextMenuItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img2</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">ImageItem</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img2</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">setXLink</span><span class="p">(</span><span class="s2">&quot;plot1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">setYLink</span><span class="p">(</span><span class="s2">&quot;plot1&quot;</span><span class="p">)</span>
        <span class="c1"># --- fluorescence trace plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">addPlot</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">ci</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">setRowStretchFactor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setColumnMinimumWidth</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setColumnMinimumWidth</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setHorizontalSpacing</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p3</span><span class="o">.</span><span class="n">setMouseEnabled</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p3</span><span class="o">.</span><span class="n">enableAutoRange</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">sigMouseClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_clicked</span><span class="p">)</span>
        <span class="c1"># self.key_on(self.win.scene().keyPressEvent)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1">###### --------- QUADRANT AND VIEW AND COLOR BUTTONS ---------- #############</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">views</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Q: ROIs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;W: mean img&quot;</span><span class="p">,</span>
            <span class="s2">&quot;E: mean img (enhanced)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;R: correlation map&quot;</span><span class="p">,</span>
            <span class="s2">&quot;T: max projection&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Y: mean img (chan2, corrected)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;U: mean img (chan2)&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;A: random&quot;</span><span class="p">,</span>
            <span class="s2">&quot;S: skew&quot;</span><span class="p">,</span>
            <span class="s2">&quot;D: compact&quot;</span><span class="p">,</span>
            <span class="s2">&quot;F: footprint&quot;</span><span class="p">,</span>
            <span class="s2">&quot;G: aspect_ratio&quot;</span><span class="p">,</span>
            <span class="s2">&quot;H: chan2_prob&quot;</span><span class="p">,</span>
            <span class="s2">&quot;J: classifier, cell prob=&quot;</span><span class="p">,</span>
            <span class="s2">&quot;K: correlations, bin=&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># quadrant buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quadbtns</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QButtonGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1">#vlabel = QtGui.QLabel(self)</span>
        <span class="c1">#vlabel.setText(&quot;&lt;font color=&#39;white&#39;&gt;Background&lt;/font&gt;&quot;)</span>
        <span class="c1">#vlabel.setFont(boldfont)</span>
        <span class="c1">#vlabel.resize(vlabel.minimumSizeHint())</span>
        <span class="c1">#self.l0.addWidget(vlabel, 1, 0, 1, 1)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
            <span class="n">btn</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">QuadButton</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quadbtns</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="mi">0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">quadbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">ypos</span><span class="p">,</span> <span class="mi">29</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">quadbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">xpos</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quadbtns</span><span class="o">.</span><span class="n">setExclusive</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># view buttons</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">boldfont</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="o">.</span><span class="n">Bold</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QButtonGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">vlabel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">vlabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&lt;font color=&#39;white&#39;&gt;Background&lt;/font&gt;&quot;</span><span class="p">)</span>
        <span class="n">vlabel</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">boldfont</span><span class="p">)</span>
        <span class="n">vlabel</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">vlabel</span><span class="o">.</span><span class="n">minimumSizeHint</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">vlabel</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">names</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">:</span>
            <span class="n">btn</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ViewButton</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s2">&quot;&amp;&quot;</span> <span class="o">+</span> <span class="n">names</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">setExclusive</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># color buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QButtonGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">clabel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">clabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&lt;font color=&#39;white&#39;&gt;Colors&lt;/font&gt;&quot;</span><span class="p">)</span>
        <span class="n">clabel</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">boldfont</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">clabel</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">nv</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">3</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># colorbars for different statistics</span>
        <span class="n">colorsAll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">colorsAll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;L: corr with 1D var, bin= ^^^&quot;</span><span class="p">)</span>
        <span class="n">colorsAll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;M: rastermap / custom&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">colorsAll</span><span class="p">:</span>
            <span class="n">btn</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ColorButton</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s2">&quot;&amp;&quot;</span> <span class="o">+</span> <span class="n">names</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">b</span><span class="o">==</span><span class="mi">5</span> <span class="ow">or</span> <span class="n">b</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="n">nv</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="n">nv</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>
            <span class="n">b</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chan2edit</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chan2edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;0.6&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chan2edit</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chan2edit</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chan2edit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chan2_prob</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chan2edit</span><span class="p">,</span> <span class="n">nv</span> <span class="o">+</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">probedit</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probedit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;0.5&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probedit</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probedit</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probedit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">classgui</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probedit</span><span class="p">,</span> <span class="n">nv</span> <span class="o">+</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">binedit</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binedit</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QIntValidator</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binedit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binedit</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binedit</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binedit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_change</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activityMode</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binedit</span><span class="p">,</span> <span class="n">nv</span> <span class="o">+</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bend</span> <span class="o">=</span> <span class="n">nv</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">4</span>
        <span class="n">colorbarW</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">GraphicsLayoutWidget</span><span class="p">()</span>
        <span class="n">colorbarW</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">colorbarW</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
        <span class="n">colorbarW</span><span class="o">.</span><span class="n">ci</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">setRowStretchFactor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">colorbarW</span><span class="o">.</span><span class="n">ci</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">colorbarW</span><span class="p">,</span> <span class="n">nv</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorbar</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">ImageItem</span><span class="p">()</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">colorbarW</span><span class="o">.</span><span class="n">addViewBox</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">setMenuEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colorbar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clabel</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">colorbarW</span><span class="o">.</span><span class="n">addLabel</span><span class="p">(</span><span class="s2">&quot;0.0&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">colorbarW</span><span class="o">.</span><span class="n">addLabel</span><span class="p">(</span><span class="s2">&quot;0.5&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">colorbarW</span><span class="o">.</span><span class="n">addLabel</span><span class="p">(</span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="c1"># ----- CLASSIFIER BUTTONS -------</span>
        <span class="n">cllabel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">cllabel</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">boldfont</span><span class="p">)</span>
        <span class="n">cllabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&lt;font color=&#39;white&#39;&gt;Classifier&lt;/font&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classLabel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&lt;font color=&#39;white&#39;&gt;not loaded (using prob from iscell.npy)&lt;/font&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classLabel</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cllabel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bend</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classLabel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bend</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addtoclass</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot; add current data to classifier&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addtoclass</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addtoclass</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">classgui</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addtoclass</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleInactive</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addtoclass</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bend</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># ------ CELL STATS --------</span>
        <span class="c1"># which stats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bend</span> <span class="o">+</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_to_show</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;med&quot;</span><span class="p">,</span>
            <span class="s2">&quot;npix&quot;</span><span class="p">,</span>
            <span class="s2">&quot;skew&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compact&quot;</span><span class="p">,</span>
            <span class="s2">&quot;footprint&quot;</span><span class="p">,</span>
            <span class="s2">&quot;aspect_ratio&quot;</span>
        <span class="p">]</span>
        <span class="n">lilfont</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">qlabel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">qlabel</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">boldfont</span><span class="p">)</span>
        <span class="n">qlabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&lt;font color=&#39;white&#39;&gt;Selected ROI:&lt;/font&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">qlabel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bend</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROIedit</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROIedit</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QIntValidator</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROIedit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROIedit</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROIedit</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROIedit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_chosen</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROIedit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bend</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROIstats</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROIstats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qlabel</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats_to_show</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">llabel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats_to_show</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ROIstats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">llabel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ROIstats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">lilfont</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ROIstats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: white;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ROIstats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROIstats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">minimumSizeHint</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROIstats</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bend</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">bend</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">setRowStretch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bend</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># combo box to decide what kind of activity to view</span>
        <span class="n">qlabel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">qlabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&lt;font color=&#39;white&#39;&gt;Activity mode:&lt;/font&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">qlabel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bend</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comboBox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comboBox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bend</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s2">&quot;Fneu&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s2">&quot;F - 0.7*Fneu&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s2">&quot;deconvolved&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activityMode</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activityMode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_change</span><span class="p">)</span>
        <span class="c1"># up/down arrows to resize view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrowButtons</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot; </span><span class="se">\u25b2</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot; </span><span class="se">\u25bc</span><span class="s2">&quot;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrowButtons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expand_trace</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrowButtons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collapse_trace</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrowButtons</span><span class="p">:</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleUnpressed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span>
                <span class="n">btn</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bend</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span>
            <span class="p">)</span>
            <span class="n">b</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmButtons</span> <span class="o">=</span> <span class="p">[</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot; +&quot;</span><span class="p">),</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot; -&quot;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmButtons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expand_scale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmButtons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collapse_scale</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sc</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmButtons</span><span class="p">:</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleUnpressed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bend</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># choose max # of cells plotted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&lt;font color=&#39;white&#39;&gt;max # plotted:&lt;/font&gt;&quot;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bend</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncedit</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncedit</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QIntValidator</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncedit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;40&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncedit</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncedit</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncedit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc_chosen</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncedit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bend</span> <span class="o">+</span> <span class="mi">7</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># labels for traces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traceLabel</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traceText</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;&lt;font color=&#39;blue&#39;&gt;fluorescence&lt;/font&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&lt;font color=&#39;red&#39;&gt;neuropil&lt;/font&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&lt;font color=&#39;gray&#39;&gt;deconvolved&lt;/font&gt;&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">traceLabel</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">traceText</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">traceLabel</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">boldfont</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">l0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">traceLabel</span><span class="p">[</span><span class="n">n</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bend</span> <span class="o">+</span> <span class="mi">7</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span>
                <span class="mi">4</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
            <span class="p">)</span>
        <span class="c1"># initialize merges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">merged</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rastermap</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classorig</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_keys</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s2">&quot;keys&quot;</span><span class="p">]</span>

        <span class="c1"># load initial file</span>
        <span class="c1">#statfile = &#39;D:/DATA/GT1/multichannel_half/suite2p/plane0/stat.npy&#39;</span>
        <span class="k">if</span> <span class="n">statfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">statfile</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_proc</span><span class="p">()</span></div>
            <span class="c1">#self.manual_label()</span>


<div class="viewcode-block" id="MainW.export_fig"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.export_fig">[docs]</a>    <span class="k">def</span> <span class="nf">export_fig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">contextMenuItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">showExportDialog</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainW.mode_change"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.mode_change">[docs]</a>    <span class="k">def</span> <span class="nf">mode_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            changes the activity mode that is used when multiple neurons are selected</span>
<span class="sd">            or in visualization windows like rastermap or for correlation computation!</span>

<span class="sd">            activityMode =</span>
<span class="sd">            0 : F</span>
<span class="sd">            1 : Fneu</span>
<span class="sd">            2 : F - 0.7 * Fneu (default)</span>
<span class="sd">            3 : spks</span>

<span class="sd">            uses binning set by self.bin</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activityMode</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span><span class="p">:</span>
            <span class="c1"># activity used for correlations</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binedit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">nb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fcell</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fcell</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fneu</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fcell</span> <span class="o">-</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fneu</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Spks</span>
            <span class="n">ncells</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fbin</span> <span class="o">=</span> <span class="n">f</span><span class="p">[:,</span> <span class="p">:</span> <span class="n">nb</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="p">(</span><span class="n">ncells</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Fbin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fbin</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fbin</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fstd</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fbin</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fcell</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1"># if in correlation-view, recompute</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">corr_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">beh_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">plot_colorbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">draw_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">plot_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainW.keyPressEvent"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.keyPressEvent">[docs]</a>    <span class="k">def</span> <span class="nf">keyPressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">modifiers</span><span class="p">()</span> <span class="o">!=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">modifiers</span><span class="p">()</span> <span class="o">!=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ShiftModifier</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Return</span><span class="p">:</span>
                    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imerge</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">merge_cells</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Escape</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">zoom_plot</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">zoom_plot</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Delete</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ROI_remove</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Q</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_W</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_E</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_R</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_T</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_U</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;meanImg_chan2&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Y</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;meanImg_chan2_corrected&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Space</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">checkBox</span><span class="o">.</span><span class="n">toggle</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_A</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_S</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_D</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_F</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_G</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_H</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasred</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_J</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_K</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_L</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bloaded</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_M</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rastermap</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Left</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">imerge</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ichosen_stats</span><span class="p">()</span>
                    <span class="n">M</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">draw_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">plot_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Right</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">imerge</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ichosen_stats</span><span class="p">()</span>
                    <span class="n">M</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">draw_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">plot_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="MainW.merge_cells"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.merge_cells">[docs]</a>    <span class="k">def</span> <span class="nf">merge_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dm</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="s2">&quot;Merge cells&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Do you want to merge selected cells?&quot;</span><span class="p">,</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">dm</span> <span class="o">==</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
            <span class="n">nmerged</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged</span><span class="p">)</span>
            <span class="n">merge</span><span class="o">.</span><span class="n">activity_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">merge</span><span class="o">.</span><span class="n">fig_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">draw_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">plot_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">merged</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imerge</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;merged ROIs&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainW.expand_scale"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.expand_scale">[docs]</a>    <span class="k">def</span> <span class="nf">expand_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sc</span> <span class="o">+=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sc</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainW.collapse_scale"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.collapse_scale">[docs]</a>    <span class="k">def</span> <span class="nf">collapse_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sc</span> <span class="o">-=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sc</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainW.expand_trace"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.expand_trace">[docs]</a>    <span class="k">def</span> <span class="nf">expand_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">ci</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">setRowStretchFactor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainW.collapse_trace"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.collapse_trace">[docs]</a>    <span class="k">def</span> <span class="nf">collapse_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">ci</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">setRowStretchFactor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainW.nc_chosen"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.nc_chosen">[docs]</a>    <span class="k">def</span> <span class="nf">nc_chosen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainW.top_number_chosen"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.top_number_chosen">[docs]</a>    <span class="k">def</span> <span class="nf">top_number_chosen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ntop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topedit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sizebtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">top_selection</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainW.top_selection"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.top_selection">[docs]</a>    <span class="k">def</span> <span class="nf">top_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROI_remove</span><span class="p">()</span>
        <span class="n">draw</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">ncells</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">)</span>
        <span class="n">icells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">ncells</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ntop</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">bid</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sizebtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">wplot</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">draw</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sizebtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">wplot</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">draw</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># correlation view</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">istat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">istat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">istat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                <span class="c1"># statistics view</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">istat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">3</span><span class="p">][:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">wplot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">icell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iscell</span><span class="o">.</span><span class="n">nonzero</span><span class="p">())</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                    <span class="n">istat</span> <span class="o">=</span> <span class="n">istat</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">iscell</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">icell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">iscell</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">())</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                    <span class="n">istat</span> <span class="o">=</span> <span class="n">istat</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">iscell</span><span class="p">]</span>
                <span class="n">inds</span> <span class="o">=</span> <span class="n">istat</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">top</span><span class="p">:</span>
                    <span class="n">inds</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[:</span><span class="n">icells</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span> <span class="o">=</span> <span class="n">icell</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inds</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[</span><span class="o">-</span><span class="n">icells</span><span class="p">:]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span> <span class="o">=</span> <span class="n">icell</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">imerge</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">inds</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">imerge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">icell</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
                <span class="c1"># draw choices</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">corr_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">plot_colorbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ichosen_stats</span><span class="p">()</span>
                <span class="n">M</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">draw_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">plot_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainW.ROI_selection"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.ROI_selection">[docs]</a>    <span class="k">def</span> <span class="nf">ROI_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">draw</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sizebtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">wplot</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">viewRange</span><span class="p">()</span>
            <span class="n">draw</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sizebtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">wplot</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">viewRange</span><span class="p">()</span>
            <span class="n">draw</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ROI_remove</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stylePressed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ROIplot</span> <span class="o">=</span> <span class="n">wplot</span>
            <span class="n">imx</span> <span class="o">=</span> <span class="p">(</span><span class="n">view</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">view</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">imy</span> <span class="o">=</span> <span class="p">(</span><span class="n">view</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">view</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">view</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">view</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">4</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">view</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">view</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">4</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
            <span class="n">imx</span> <span class="o">=</span> <span class="n">imx</span> <span class="o">-</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">imy</span> <span class="o">=</span> <span class="n">imy</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ROI</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">RectROI</span><span class="p">(</span>
                <span class="p">[</span><span class="n">imx</span><span class="p">,</span> <span class="n">imy</span><span class="p">],</span> <span class="p">[</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">],</span>
                <span class="n">pen</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">sideScalers</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">wplot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROI</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROI</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ROI_position</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ROI</span><span class="o">.</span><span class="n">sigRegionChangeFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROI_position</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isROI</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MainW.ROI_remove"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.ROI_remove">[docs]</a>    <span class="k">def</span> <span class="nf">ROI_remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isROI</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROIplot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROI</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROI</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isROI</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sizebtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleInactive</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleUnpressed</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainW.ROI_position"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.ROI_position">[docs]</a>    <span class="k">def</span> <span class="nf">ROI_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pos0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI</span><span class="o">.</span><span class="n">getSceneHandlePositions</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROIplot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">mapSceneToView</span><span class="p">(</span><span class="n">pos0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">mapSceneToView</span><span class="p">(</span><span class="n">pos0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">posy</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>
        <span class="n">posx</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
        <span class="n">sizex</span><span class="p">,</span> <span class="n">sizey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="n">xrange</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">sizex</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">posx</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">yrange</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">sizey</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">posy</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">xrange</span> <span class="o">=</span> <span class="n">xrange</span><span class="p">[</span><span class="n">xrange</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">xrange</span> <span class="o">=</span> <span class="n">xrange</span><span class="p">[</span><span class="n">xrange</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s2">&quot;Lx&quot;</span><span class="p">]]</span>
        <span class="n">yrange</span> <span class="o">=</span> <span class="n">yrange</span><span class="p">[</span><span class="n">yrange</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">yrange</span> <span class="o">=</span> <span class="n">yrange</span><span class="p">[</span><span class="n">yrange</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s2">&quot;Ly&quot;</span><span class="p">]]</span>
        <span class="n">ypix</span><span class="p">,</span> <span class="n">xpix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">yrange</span><span class="p">,</span> <span class="n">xrange</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_cells</span><span class="p">(</span><span class="n">ypix</span><span class="p">,</span> <span class="n">xpix</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainW.number_chosen"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.number_chosen">[docs]</a>    <span class="k">def</span> <span class="nf">number_chosen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROIedit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imerge</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">corr_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">plot_colorbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ichosen_stats</span><span class="p">()</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">draw_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">plot_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainW.select_cells"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.select_cells">[docs]</a>    <span class="k">def</span> <span class="nf">select_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ypix</span><span class="p">,</span> <span class="n">xpix</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROIplot</span>
        <span class="n">iROI0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iROI</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ypix</span><span class="p">,</span> <span class="n">xpix</span><span class="p">]</span>
        <span class="n">icells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">iROI0</span><span class="p">[</span><span class="n">iROI0</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imerge</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">icells</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iROI</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="n">ypix</span><span class="p">,</span> <span class="n">xpix</span><span class="p">]</span> <span class="o">==</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;npix&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">imerge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imerge</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imerge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">corr_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">plot_colorbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ichosen_stats</span><span class="p">()</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">draw_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">plot_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainW.make_masks_and_buttons"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.make_masks_and_buttons">[docs]</a>    <span class="k">def</span> <span class="nf">make_masks_and_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadBeh</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveMat</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manual</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bloaded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROI_remove</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isROI</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>
        <span class="c1"># set bin size to be 0.5s by default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s2">&quot;tau&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s2">&quot;fs&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binedit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin</span><span class="p">))</span>
        <span class="k">if</span> <span class="s2">&quot;chan2_thres&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s2">&quot;chan2_thres&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chan2prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s2">&quot;chan2_thres&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chan2edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chan2prob</span><span class="p">))</span>
        <span class="c1"># add boundaries to stat for ROI overlays</span>
        <span class="n">ncells</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ncells</span><span class="p">):</span>
            <span class="n">ypix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;ypix&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">xpix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;xpix&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">iext</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">boundary</span><span class="p">(</span><span class="n">ypix</span><span class="p">,</span> <span class="n">xpix</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;yext&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ypix</span><span class="p">[</span><span class="n">iext</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;xext&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xpix</span><span class="p">[</span><span class="n">iext</span><span class="p">]</span>
            <span class="n">ycirc</span><span class="p">,</span> <span class="n">xcirc</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;med&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">goodi</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">ycirc</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">xcirc</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">ycirc</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s2">&quot;Ly&quot;</span><span class="p">])</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">xcirc</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s2">&quot;Lx&quot;</span><span class="p">])</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;ycirc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ycirc</span><span class="p">[</span><span class="n">goodi</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;xcirc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xcirc</span><span class="p">[</span><span class="n">goodi</span><span class="p">]</span>
        <span class="c1"># enable buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_views_and_classifier</span><span class="p">()</span>
        <span class="c1"># make color arrays for various views</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">make_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imerge</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iflip</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ichosen_stats</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># colorbar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colormat</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">make_colorbar</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">plot_colorbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">init_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">tic</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">draw_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">plot_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lcell1</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ncells</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">iscell</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lcell0</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iscell</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">init_range</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;aspect&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xyrat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s1">&#39;aspect&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;diameter&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s2">&quot;diameter&quot;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s2">&quot;diameter&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xyrat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s2">&quot;diameter&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s2">&quot;diameter&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xyrat</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">setAspectLocked</span><span class="p">(</span><span class="n">lock</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xyrat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">setAspectLocked</span><span class="p">(</span><span class="n">lock</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xyrat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_change</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="c1"># no classifier loaded</span>
        <span class="n">classgui</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainW.enable_views_and_classifier"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.enable_views_and_classifier">[docs]</a>    <span class="k">def</span> <span class="nf">enable_views_and_classifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quadbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quadbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleUnpressed</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleUnpressed</span><span class="p">)</span>
            <span class="c1"># self.viewbtns.button(b).setShortcut(QtGui.QKeySequence(&#39;R&#39;))</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stylePressed</span><span class="p">)</span>
        <span class="c1"># check for second channel</span>
        <span class="k">if</span> <span class="s2">&quot;meanImg_chan2_corrected&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleInactive</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;meanImg_chan2&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleInactive</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">b</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasred</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleUnpressed</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">b</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stylePressed</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleUnpressed</span><span class="p">)</span>
        <span class="c1">#self.applyclass.setStyleSheet(self.styleUnpressed)</span>
        <span class="c1">#self.applyclass.setEnabled(True)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sizebtns</span><span class="o">.</span><span class="n">buttons</span><span class="p">():</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleUnpressed</span><span class="p">)</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">btn</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">btn</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stylePressed</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleInactive</span><span class="p">)</span>
        <span class="c1"># enable classifier menu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadClass</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadTrain</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadUClass</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadSClass</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resetDefault</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visualizations</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custommask</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>
        <span class="c1"># self.p1.scene().showExportDialog()</span>

<div class="viewcode-block" id="MainW.ROIs_on"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.ROIs_on">[docs]</a>    <span class="k">def</span> <span class="nf">ROIs_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span><span class="p">:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">draw_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">plot_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainW.plot_clicked"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.plot_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">plot_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;left-click chooses a cell, right-click flips cell to other view&quot;&quot;&quot;</span>
        <span class="n">flip</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">choose</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">zoom</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">replot</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">scenePos</span><span class="p">())</span>
        <span class="n">posx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">posy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iplot</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span><span class="p">:</span>
            <span class="c1"># print(event.modifiers() == QtCore.Qt.ControlModifier)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">img1</span><span class="p">:</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">mapSceneToView</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">scenePos</span><span class="p">())</span>
                    <span class="n">posy</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
                    <span class="n">posx</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>
                    <span class="n">iplot</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">img2</span><span class="p">:</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">mapSceneToView</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">scenePos</span><span class="p">())</span>
                    <span class="n">posy</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
                    <span class="n">posx</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>
                    <span class="n">iplot</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">p3</span><span class="p">:</span>
                    <span class="n">iplot</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="n">x</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img1</span> <span class="ow">and</span>
                    <span class="n">x</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img2</span>
                <span class="p">):</span>
                    <span class="n">iplot</span> <span class="o">=</span> <span class="mi">4</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">double</span><span class="p">():</span>
                        <span class="n">zoom</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">flip</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">double</span><span class="p">():</span>
                            <span class="n">zoom</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">choose</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">double</span><span class="p">():</span>
                    <span class="n">zoom</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">posy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">posy</span><span class="p">)</span>
                <span class="n">posx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">posx</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">zoom</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">zoom_plot</span><span class="p">(</span><span class="n">iplot</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">choose</span> <span class="ow">or</span> <span class="n">flip</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">iplot</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="n">ichosen</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iROI</span><span class="p">[</span><span class="n">iplot</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">posx</span><span class="p">,</span> <span class="n">posy</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">ichosen</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">choose</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">flip</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">choose</span><span class="p">:</span>
                    <span class="n">merged</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">modifiers</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ShiftModifier</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">modifiers</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iscell</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">imerge</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">iscell</span><span class="p">[</span><span class="n">ichosen</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">ichosen</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">imerge</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">imerge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ichosen</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span> <span class="o">=</span> <span class="n">ichosen</span>
                                <span class="n">merged</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">elif</span> <span class="n">ichosen</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">imerge</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imerge</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">imerge</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ichosen</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imerge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="n">merged</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">merged</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">imerge</span> <span class="o">=</span> <span class="p">[</span><span class="n">ichosen</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span> <span class="o">=</span> <span class="n">ichosen</span>
                <span class="k">if</span> <span class="n">flip</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ichosen</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">imerge</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">imerge</span> <span class="o">=</span> <span class="p">[</span><span class="n">ichosen</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span> <span class="o">=</span> <span class="n">ichosen</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">flip_plot</span><span class="p">(</span><span class="n">iplot</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">choose</span> <span class="ow">or</span> <span class="n">flip</span> <span class="ow">or</span> <span class="n">replot</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isROI</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ROI_remove</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sizebtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="k">for</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topbtns</span><span class="o">.</span><span class="n">buttons</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">btn</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                                <span class="n">btn</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleUnpressed</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">corr_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">plot_colorbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops_plot</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ichosen_stats</span><span class="p">()</span>
                    <span class="n">M</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">draw_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">plot_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">event</span><span class="o">.</span><span class="n">acceptedItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">raiseContextMenu</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">event</span><span class="o">.</span><span class="n">acceptedItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">raiseContextMenu</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainW.ichosen_stats"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.ichosen_stats">[docs]</a>    <span class="k">def</span> <span class="nf">ichosen_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROIedit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats_to_show</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_to_show</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">ival</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ROIstats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;: [</span><span class="si">%d</span><span class="s2">, </span><span class="si">%d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ival</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ival</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ROIstats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ival</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ROIstats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;: </span><span class="si">%2.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ival</span><span class="p">))</span></div>

<div class="viewcode-block" id="MainW.flip_plot"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.flip_plot">[docs]</a>    <span class="k">def</span> <span class="nf">flip_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iplot</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iflip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">imerge</span><span class="p">:</span>
            <span class="n">iscell</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iscell</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iscell</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">iscell</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ichosen</span> <span class="o">=</span> <span class="n">n</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">flip_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">basename</span> <span class="o">+</span> <span class="s2">&quot;/iscell.npy&quot;</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iscell</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probcell</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lcell0</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iscell</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lcell1</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iscell</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">iscell</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span></div>

<div class="viewcode-block" id="MainW.chan2_prob"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.chan2_prob">[docs]</a>    <span class="k">def</span> <span class="nf">chan2_prob</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">chan2prob</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chan2edit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chan2prob</span> <span class="o">-</span> <span class="n">chan2prob</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chan2prob</span> <span class="o">=</span> <span class="n">chan2prob</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redcell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">probredcell</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">chan2prob</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">chan2_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">draw_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">plot_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">M</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span> <span class="s1">&#39;redcell.npy&#39;</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redcell</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probredcell</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="MainW.zoom_plot"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.zoom_plot">[docs]</a>    <span class="k">def</span> <span class="nf">zoom_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iplot</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">setXRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s2">&quot;Lx&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">setYRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s2">&quot;Ly&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">setXRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s2">&quot;Lx&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">setYRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s2">&quot;Ly&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p3</span><span class="o">.</span><span class="n">setXRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fcell</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p3</span><span class="o">.</span><span class="n">setYRange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainW.run_suite2p"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.run_suite2p">[docs]</a>    <span class="k">def</span> <span class="nf">run_suite2p</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">RW</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">RunWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">RW</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainW.manual_label"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.manual_label">[docs]</a>    <span class="k">def</span> <span class="nf">manual_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">MW</span> <span class="o">=</span> <span class="n">drawroi</span><span class="o">.</span><span class="n">ROIDraw</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">MW</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainW.vis_window"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.vis_window">[docs]</a>    <span class="k">def</span> <span class="nf">vis_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">VW</span> <span class="o">=</span> <span class="n">visualize</span><span class="o">.</span><span class="n">VisWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">VW</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainW.reg_window"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.reg_window">[docs]</a>    <span class="k">def</span> <span class="nf">reg_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">RW</span> <span class="o">=</span> <span class="n">reggui</span><span class="o">.</span><span class="n">BinaryPlayer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">RW</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainW.regPC_window"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.regPC_window">[docs]</a>    <span class="k">def</span> <span class="nf">regPC_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">RW</span> <span class="o">=</span> <span class="n">reggui</span><span class="o">.</span><span class="n">PCViewer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">RW</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainW.load_dialog"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.load_dialog">[docs]</a>    <span class="k">def</span> <span class="nf">load_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Open stat.npy&quot;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s2">&quot;stat.npy&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_proc</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainW.load_proc"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.load_proc">[docs]</a>    <span class="k">def</span> <span class="nf">load_proc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ypix</span> <span class="o">=</span> <span class="n">stat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;ypix&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span>
                <span class="ne">RuntimeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: this is not a stat.npy file :( &#39;</span>
                  <span class="s1">&#39;(needs stat[n][&quot;ypix&quot;]!)&#39;</span><span class="p">)</span>
            <span class="n">stat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">stat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">basename</span><span class="p">,</span> <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">goodfolder</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Fcell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">basename</span> <span class="o">+</span> <span class="s2">&quot;/F.npy&quot;</span><span class="p">)</span>
                <span class="n">Fneu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">basename</span> <span class="o">+</span> <span class="s2">&quot;/Fneu.npy&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;ERROR: there are no fluorescence traces in this folder &quot;</span>
                    <span class="s2">&quot;(F.npy/Fneu.npy)&quot;</span>
                <span class="p">)</span>
                <span class="n">goodfolder</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Spks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">basename</span> <span class="o">+</span> <span class="s2">&quot;/spks.npy&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;there are no spike deconvolved traces in this folder &quot;</span>
                      <span class="s2">&quot;(spks.npy)&quot;</span><span class="p">)</span>
                <span class="n">goodfolder</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ops</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">basename</span> <span class="o">+</span> <span class="s2">&quot;/ops.npy&quot;</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: there is no ops file in this folder (ops.npy)&quot;</span><span class="p">)</span>
                <span class="n">goodfolder</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">iscell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">basename</span> <span class="o">+</span> <span class="s2">&quot;/iscell.npy&quot;</span><span class="p">)</span>
                <span class="n">probcell</span> <span class="o">=</span> <span class="n">iscell</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">iscell</span> <span class="o">=</span> <span class="n">iscell</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no manual labels found (iscell.npy)&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">goodfolder</span><span class="p">:</span>
                    <span class="n">NN</span> <span class="o">=</span> <span class="n">Fcell</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">iscell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">NN</span><span class="p">,),</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
                    <span class="n">probcell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">NN</span><span class="p">,),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">redcell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">basename</span> <span class="o">+</span> <span class="s2">&quot;/redcell.npy&quot;</span><span class="p">)</span>
                <span class="n">probredcell</span> <span class="o">=</span> <span class="n">redcell</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">redcell</span> <span class="o">=</span> <span class="n">redcell</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hasred</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no channel 2 labels found (redcell.npy)&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hasred</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">goodfolder</span><span class="p">:</span>
                    <span class="n">NN</span> <span class="o">=</span> <span class="n">Fcell</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">redcell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">NN</span><span class="p">,),</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
                    <span class="n">probredcell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">NN</span><span class="p">,),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">goodfolder</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">basename</span> <span class="o">=</span> <span class="n">basename</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stat</span> <span class="o">=</span> <span class="n">stat</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ops</span> <span class="o">=</span> <span class="n">ops</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Fcell</span> <span class="o">=</span> <span class="n">Fcell</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Fneu</span> <span class="o">=</span> <span class="n">Fneu</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Spks</span> <span class="o">=</span> <span class="n">Spks</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">iscell</span> <span class="o">=</span> <span class="n">iscell</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">probcell</span> <span class="o">=</span> <span class="n">probcell</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redcell</span> <span class="o">=</span> <span class="n">redcell</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">probredcell</span> <span class="o">=</span> <span class="n">probredcell</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;chan2_prob&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">probredcell</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">make_masks_and_buttons</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;stat.npy found, but other files not in folder&quot;</span><span class="p">)</span>
                <span class="n">Text</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;stat.npy found, but other files missing, &quot;</span>
                        <span class="s2">&quot;choose another?&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_again</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Text</span> <span class="o">=</span> <span class="s2">&quot;Incorrect file, not a stat.npy, choose another?&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_again</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainW.load_behavior"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.load_behavior">[docs]</a>    <span class="k">def</span> <span class="nf">load_behavior</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Open *.npy&quot;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s2">&quot;*.npy&quot;</span>
        <span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bloaded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">beh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">bresample</span><span class="o">=</span><span class="kc">False</span>
            <span class="k">if</span> <span class="n">beh</span><span class="o">.</span><span class="n">ndim</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">beh</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">beh</span> <span class="o">=</span> <span class="n">beh</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">beh</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fcell</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">bloaded</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">beh_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fcell</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bloaded</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">beh_time</span> <span class="o">=</span> <span class="n">beh</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">beh</span> <span class="o">=</span> <span class="n">beh</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">bresample</span><span class="o">=</span><span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">beh</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fcell</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bloaded</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">beh_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fcell</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span>
                <span class="ne">RuntimeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: this is not a 1D array with length of data&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bloaded</span><span class="p">:</span>
            <span class="n">beh</span> <span class="o">-=</span> <span class="n">beh</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">beh</span> <span class="o">/=</span> <span class="n">beh</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beh</span> <span class="o">=</span> <span class="n">beh</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beh_time</span> <span class="o">=</span> <span class="n">beh_time</span>
            <span class="k">if</span> <span class="n">bresample</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">beh_resampled</span> <span class="o">=</span> <span class="n">resample_frames</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beh_time</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Fcell</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">beh_resampled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beh</span>
            <span class="n">b</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleUnpressed</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">beh_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: this is not a 1D array with length of data&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainW.save_mat"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.save_mat">[docs]</a>    <span class="k">def</span> <span class="nf">save_mat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">matpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span><span class="s1">&#39;Fall.mat&#39;</span><span class="p">)</span>
        <span class="n">io</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="n">matpath</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">,</span>
                             <span class="s1">&#39;ops&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">,</span>
                             <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fcell</span><span class="p">,</span>
                             <span class="s1">&#39;Fneu&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fneu</span><span class="p">,</span>
                             <span class="s1">&#39;spks&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Spks</span><span class="p">,</span>
                             <span class="s1">&#39;iscell&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">iscell</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">probcell</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                             <span class="p">})</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;saving to mat&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainW.load_custom_mask"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.load_custom_mask">[docs]</a>    <span class="k">def</span> <span class="nf">load_custom_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Open *.npy&quot;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s2">&quot;*.npy&quot;</span>
        <span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cloaded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fcell</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cloaded</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span>
                <span class="ne">RuntimeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: this is not a 1D array with length of data&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">custom_mask</span> <span class="o">=</span> <span class="n">mask</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">custom_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">draw_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleUnpressed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colorbtns</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
            <span class="c1">#fig.plot_masks(self,M)</span>
            <span class="c1">#fig.plot_colorbar(self,bid)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: this is not a 1D array with length of # of ROIs&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MainW.load_again"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.load_again">[docs]</a>    <span class="k">def</span> <span class="nf">load_again</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Text</span><span class="p">):</span>
        <span class="n">tryagain</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">tryagain</span> <span class="o">==</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_dialog</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainW.load_classifier"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.load_classifier">[docs]</a>    <span class="k">def</span> <span class="nf">load_classifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Open File&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">classgui</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">class_activated</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no classifier&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainW.load_s2p_classifier"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.load_s2p_classifier">[docs]</a>    <span class="k">def</span> <span class="nf">load_s2p_classifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">classgui</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">classorig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_file</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveDefault</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainW.load_default_classifier"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.load_default_classifier">[docs]</a>    <span class="k">def</span> <span class="nf">load_default_classifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">classgui</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                <span class="s2">&quot;classifiers/classifier_user.npy&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_activated</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainW.class_file"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.class_file">[docs]</a>    <span class="k">def</span> <span class="nf">class_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">classfile</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
            <span class="s2">&quot;classifiers/classifier_user.npy&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">cfile</span> <span class="o">=</span> <span class="s2">&quot;default classifier&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">classfile</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
            <span class="s2">&quot;classifiers/classifier.npy&quot;</span>
        <span class="p">):</span>
            <span class="n">cfile</span> <span class="o">=</span> <span class="s2">&quot;suite2p classifier&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classfile</span>
        <span class="n">cstr</span> <span class="o">=</span> <span class="s2">&quot;&lt;font color=&#39;white&#39;&gt;&quot;</span> <span class="o">+</span> <span class="n">cfile</span> <span class="o">+</span> <span class="s2">&quot;&lt;/font&gt;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">cstr</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainW.class_activated"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.class_activated">[docs]</a>    <span class="k">def</span> <span class="nf">class_activated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_file</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveDefault</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addtoclass</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleUnpressed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addtoclass</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainW.class_default"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.class_default">[docs]</a>    <span class="k">def</span> <span class="nf">class_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dm</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="s2">&quot;Default classifier&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Are you sure you want to overwrite your default classifier?&quot;</span><span class="p">,</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">dm</span> <span class="o">==</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
            <span class="n">classfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                <span class="s2">&quot;classifiers/classifier_user.npy&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">classgui</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="n">classfile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">iscell</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainW.reset_default"><a class="viewcode-back" href="../../api.html#suite2p.gui2p.MainW.reset_default">[docs]</a>    <span class="k">def</span> <span class="nf">reset_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dm</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="s2">&quot;Default classifier&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;Are you sure you want to reset the default classifier &quot;</span>
             <span class="s2">&quot;to the built-in suite2p classifier?&quot;</span><span class="p">),</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">dm</span> <span class="o">==</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
            <span class="n">classfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                <span class="s2">&quot;classifiers/classifier_user.npy&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classorig</span><span class="p">,</span> <span class="n">classfile</span><span class="p">)</span></div></div>

    <span class="c1"># def save_gui_data(self):</span>
    <span class="c1">#    gui_data = {</span>
    <span class="c1">#                &#39;RGBall&#39;: self.RGBall,</span>
    <span class="c1">#                &#39;RGBback&#39;: self.RGBback,</span>
    <span class="c1">#                &#39;Vback&#39;: self.Vback,</span>
    <span class="c1">#                &#39;iROI&#39;: self.iROI,</span>
    <span class="c1">#                &#39;iExt&#39;: self.iExt,</span>
    <span class="c1">#                &#39;Sroi&#39;: self.Sroi,</span>
    <span class="c1">#                &#39;Sext&#39;: self.Sext,</span>
    <span class="c1">#                &#39;Lam&#39;: self.Lam,</span>
    <span class="c1">#                &#39;LamMean&#39;: self.LamMean,</span>
    <span class="c1">#                &#39;wasloaded&#39;: True</span>
    <span class="c1">#               }</span>
    <span class="c1">#    np.save(self.basename+&#39;/gui_data.npy&#39;, gui_data)</span>


<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">statfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Always start by initializing Qt (only once per application)</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">icon_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s2">&quot;logo/logo.png&quot;</span>
    <span class="p">)</span>
    <span class="n">app_icon</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">()</span>
    <span class="n">app_icon</span><span class="o">.</span><span class="n">addFile</span><span class="p">(</span><span class="n">icon_path</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
    <span class="n">app_icon</span><span class="o">.</span><span class="n">addFile</span><span class="p">(</span><span class="n">icon_path</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
    <span class="n">app_icon</span><span class="o">.</span><span class="n">addFile</span><span class="p">(</span><span class="n">icon_path</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
    <span class="n">app_icon</span><span class="o">.</span><span class="n">addFile</span><span class="p">(</span><span class="n">icon_path</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mi">48</span><span class="p">))</span>
    <span class="n">app_icon</span><span class="o">.</span><span class="n">addFile</span><span class="p">(</span><span class="n">icon_path</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="mi">96</span><span class="p">))</span>
    <span class="n">app_icon</span><span class="o">.</span><span class="n">addFile</span><span class="p">(</span><span class="n">icon_path</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>
    <span class="n">app</span><span class="o">.</span><span class="n">setWindowIcon</span><span class="p">(</span><span class="n">app_icon</span><span class="p">)</span>
    <span class="n">GUI</span> <span class="o">=</span> <span class="n">MainW</span><span class="p">(</span><span class="n">statfile</span><span class="o">=</span><span class="n">statfile</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
    <span class="c1"># GUI.save_gui_data()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>


<span class="c1"># run()</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Carsen Stringer, Marius Pachitariu

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>